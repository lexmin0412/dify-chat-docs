"use strict";(self.webpackChunkdify_chat_docs=self.webpackChunkdify_chat_docs||[]).push([["9442"],{6470:function(n,e,t){t.r(e),t.d(e,{default:()=>a});var r=t(1549),s=t(6603);function o(n){let e=Object.assign({h1:"h1",code:"code",a:"a",p:"p",img:"img",h2:"h2",pre:"pre",h3:"h3",h4:"h4",strong:"strong"},(0,s.ah)(),n.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.h1,{id:"dify-chatcore",children:[(0,r.jsx)(e.code,{children:"@dify-chat/core"}),(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#dify-chatcore",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.img,{src:"https://img.shields.io/npm/v/@dify-chat/core",alt:"version"})," ",(0,r.jsx)(e.img,{src:"https://img.shields.io/npm/last-update/@dify-chat/core",alt:"NPM Last Update"})," ",(0,r.jsx)(e.img,{src:"https://img.shields.io/npm/dm/@dify-chat/core",alt:"NPM Downloads"})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"@dify-chat/core"})," 是 ",(0,r.jsx)(e.a,{href:"https://github.com/lexmin0412/dify-chat",target:"_blank",rel:"noopener noreferrer",children:"Dify Chat"})," 项目中的核心包，它提供了应用、对话等全局上下文的注入和获取功能。"]}),"\n",(0,r.jsx)(e.p,{children:"下面将介绍如何在你的应用中集成和使用它。"}),"\n",(0,r.jsxs)(e.h2,{id:"安装",children:["安装",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#安装",children:"#"})]}),"\n",(0,r.jsx)(e.p,{children:"通过 npm/yarn/pnpm 安装："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# npm\nnpm install @dify-chat/core\n# yarn\nyarn add @dify-chat/core\n# pnpm\npnpm add @dify-chat/core\n"})}),"\n",(0,r.jsxs)(e.h2,{id:"使用方法",children:["使用方法",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#使用方法",children:"#"})]}),"\n",(0,r.jsxs)(e.h3,{id:"全局上下文",children:["全局上下文",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#全局上下文",children:"#"})]}),"\n",(0,r.jsxs)(e.h4,{id:"appcontext",children:["AppContext",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#appcontext",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"AppContext"})," 是应用上下文，提供了当前应用配置的获取和更新功能。"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"AppContextProvider"})}),"\n",(0,r.jsxs)(e.p,{children:["在应用切换功能的最上层组件中使用 ",(0,r.jsx)(e.code,{children:"AppContextProvider"})," 提供应用上下文："]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"import { AppContextProvider, ICurrentApp } from '@dify-chat/core';\nimport { createDifyApiInstance } from '@dify-chat/api';\nimport { generateUuidV4 } from '@dify-chat/helpers'\n\nconst YourChatComponent = () => {\n\n  const { user } = useDifyChat();\n  const [appList, setAppList] = useState<ICurrentApp[]>([])\n\n  // 实现获取应用列表的逻辑\n  const getAppList = async () => {\n    setAppList([...])\n  }\n\n  const [appLoading, setAppLoading] = useState(true)\n  const [ currentApp, setCurrentApp ] = useState<ICurrentApp[]>([]);\n  const [currentAppId, setCurrentAppId] = useState('')\n  const [difyApi] = useState(() => createDifyApiInstance({\n    user,\n    apiBase: '',\n    apiKey: '',\n  }))\n\n  // 定义获取应用参数的函数\n  const getAppInfo = async() => {\n    // 先更新 difyApi 的参数\n    difyApi.updateOptions({\n      user,\n      apiBase: newApp.requestConfig.apiBase,\n      apiKey: newApp.requestConfig.apiKey,\n    })\n    setAppLoading(true)\n    // 根据新的 currentAppId 获取新的应用信息\n    const appConfig = appList.find(item => item.id === currentAppId)\n    const difyAppInfo = await difyApi.getAppInfo()\n		const appParameters = await getAppParameters(difyApi)\n    setAppLoading(false)\n    setCurrentApp({\n			config: {\n				id: generateUuidV4(),\n				info: difyAppInfo,\n        requestConfig: appConfig.requestConfig,\n        answerForm: appConfig.answerForm,\n			},\n			parameters: appParameters,\n		})\n  }\n\n  // 初始化时获取应用列表\n  useEffect(()=>{\n    getAppList()\n  }, [])\n\n  // 监听 currentAppId 变化，更新当前应用配置\n  useEffect(() => {\n    updateAppInfo()\n  }, [currentAppId])\n\n  return (\n    <AppContextProvider\n			value={{\n				appLoading,\n				currentAppId,\n				setCurrentAppId,\n				currentApp: currentApp,\n				setCurrentApp,\n			}}\n		>\n      Your Chat Inner Component\n      <Button onClick={()=>setCurrentAppId('new-app-id')}>切换应用</Button>\n    </>\n  )\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"useAppContext hook"})}),"\n",(0,r.jsxs)(e.p,{children:["在你的子组件中使用 ",(0,r.jsx)(e.code,{children:"useAppContext"})," 钩子获取应用上下文："]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"import { useAppContext } from '@dify-chat/core';\n\nconst YourInnerComponent = () => {\n  const { currentApp, currentAppId } = useAppContext();\n  console.log(`当前应用ID：${currentAppId}`, `当前应用：${currentApp}`);\n};\n"})}),"\n",(0,r.jsxs)(e.h4,{id:"对话上下文",children:["对话上下文",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#对话上下文",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"ConversationContext"})," 是对话上下文，提供了对话相关的功能，包括获取/更新对话列表、获取/更新当前对话 ID、获取当前对话信息等。"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"ConversationContextProvider"})}),"\n",(0,r.jsxs)(e.p,{children:["在具备对话切换功能的最上层组件中使用 ",(0,r.jsx)(e.code,{children:"ConversationContextProvider"})," 提供对话上下文："]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"import { ConversationsContextProvider } from '@dify-chat/core';\n\nconst YourChatComponent = () => {\n  const { user } = useDifyChat();\n  const [conversations, setConversations] = useState([])\n  const [currentConversationId, setCurrentConversationId] = useState('')\n\n  // 实现获取对话列表的逻辑\n  const listConversations = async () => {\n    setConversations([...])\n  }\n\n  useEffect(()=>{\n    listConversations()\n  }, [])\n\n  return (\n    <ConversationsContextProvider value={{\n      conversations,\n      setConversations,\n      currentConversationId,\n      setCurrentConversationId,\n    }}>\n      <YourInnerComponent />\n    </ConversationContextProvider>\n  )\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsxs)(e.strong,{children:[(0,r.jsx)(e.code,{children:"useConversationsContext"})," hook"]})}),"\n",(0,r.jsxs)(e.p,{children:["在你的子组件中使用 ",(0,r.jsx)(e.code,{children:"useConversationsContext"})," 钩子获取对话上下文："]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"import { useConversationsContext } from '@dify-chat/core';\n\nconst YourInnerComponent = () => {\n  const { conversations, currentConversationId } = useConversationsContext();\n  console.log(\n    `当前对话ID：${currentConversationId}`,\n    `对话列表：${conversations}`,\n  );\n};\n"})})]})}function i(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,s.ah)(),n.components);return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}let a=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["v0.5.x%2Fpackages%2Fcore.md"]={toc:[{text:"安装",id:"安装",depth:2},{text:"使用方法",id:"使用方法",depth:2},{text:"全局上下文",id:"全局上下文",depth:3},{text:"AppContext",id:"appcontext",depth:4},{text:"对话上下文",id:"对话上下文",depth:4}],title:"`@dify-chat/core`",headingTitle:"`@dify-chat/core`",frontmatter:{}}}}]);