"use strict";(self.webpackChunkdify_chat_docs=self.webpackChunkdify_chat_docs||[]).push([["6994"],{8856:function(e,n,s){s.r(n),s.d(n,{default:()=>h});var d=s(1549),r=s(6603),t=s(2118);function i(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",pre:"pre",code:"code",h3:"h3",h4:"h4",strong:"strong",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,r.ah)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.h1,{id:"自定义应用配置管理",children:["自定义应用配置管理",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#自定义应用配置管理",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"为方便演示, 在 React SPA 版本中，我们默认使用 LocalStorage 进行应用配置管理，而在 Next.js 版本中，我们默认使用的是本地 JSON 文件。"}),"\n",(0,d.jsx)(n.p,{children:"如果你想自定义应用配置管理服务，请阅读以下内容。"}),"\n",(0,d.jsxs)(n.h2,{id:"确定运行模式",children:["确定运行模式",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#确定运行模式",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"在开始配置之前，确保你的运行模式是多应用模式。"}),"\n",(0,d.jsxs)(t.mQ,{children:[(0,d.jsx)(t.OK,{label:"React SPA",children:(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-tsx",meta:'title="packages/react-app/src/App.tsx"',children:"// 初始化全局运行时配置\ndifyChatRuntimeConfig.init('multiApp')\n"})})}),(0,d.jsx)(t.OK,{label:"Next.js",children:(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",meta:'title="packages/nextjs-app/.env"',children:"# 运行模式\nRUNNING_MODE=multiApp\n"})})})]}),"\n",(0,d.jsxs)(n.h2,{id:"自定义应用配置管理-1",children:["自定义应用配置管理",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#自定义应用配置管理-1",children:"#"})]}),"\n",(0,d.jsxs)(n.h3,{id:"react-spa-版本",children:["React SPA 版本",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#react-spa-版本",children:"#"})]}),"\n",(0,d.jsxs)(n.h4,{id:"配置入口",children:["配置入口",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置入口",children:"#"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-tsx",meta:'title="packages/react-app/src/services/app/multiApp/index.ts"',children:"// 默认使用 LocalStorage 存储\nimport DifyAppService from './localstorage';\n\nexport const appService = new DifyAppService();\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"内置实现",children:["内置实现",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#内置实现",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"1. LocalStorage"})}),"\n",(0,d.jsx)(n.p,{children:"使用 LocalStorage 数据进行存储，当用户切换浏览器后，数据会丢失，仅作为演示用。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"2. 静态数据"})}),"\n",(0,d.jsx)(n.p,{children:"使用静态数据进行存储，仅支持查询，不支持修改数据，适用于用户无需自定义应用的场景。"}),"\n",(0,d.jsx)(n.p,{children:"定义用户可访问的应用列表："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",meta:'title="packages/react-app/src/services/app/multiApp/static-readonly/data.ts"',children:"import { AppModeEnums, IDifyAppItem } from '@dify-chat/core'\n\n/**\n * 静态的应用列表，用于演示\n */\nexport const staticAppList: IDifyAppItem[] = [\n	{\n		// 应用唯一标识，不重复即可\n		id: '0.270357011315995',\n		// 应用信息，包括名称、描述、标签、模式等\n		info: {\n			// 应用名称\n			name: 'My Chatflow APP',\n			// 应用描述\n			description: '我的 Chatflow 应用',\n			// 应用标签\n			tags: [],\n			// 应用模式\n			mode: AppModeEnums.CHATFLOW,\n		},\n		// API 请求配置，包括 API Base 和 API Key\n		requestConfig: {\n			// API Base 地址\n			apiBase: 'https://api.dify.ai/v1',\n			// API 密钥\n			apiKey: 'app-xxxxxxx',\n		},\n	},\n]\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"3. Restful API"})}),"\n",(0,d.jsx)(n.p,{children:"通过接口获取和修改数据，推荐使用\uD83C\uDF1F"}),"\n",(0,d.jsxs)(n.p,{children:["默认请求的后端服务地址为 ",(0,d.jsx)(n.code,{children:"http://localhost:3000"}),"，你可以根据你的需要修改。"]}),"\n",(0,d.jsx)(n.p,{children:"启动后端服务："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",meta:'title="packages/server"',children:"pnpm dev\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"自定义后端服务",children:["自定义后端服务",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#自定义后端服务",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"如果内置的 Restful 实现无法满足你的需求，你可以自定义你的后端服务，请遵循以下步骤进行操作。"}),"\n",(0,d.jsx)(n.p,{children:"首先，修改后端服务地址为你的自定义地址。"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",meta:'title="packages/react-app/src/services/app/multiApp/restful.ts"',children:"// 比如你的自定义后端服务地址是 http://localhost:4567\nconst API_BASE_URL = 'http://localhost:4567'\n"})}),"\n",(0,d.jsx)(n.p,{children:"然后，实现以下接口："}),"\n",(0,d.jsxs)(n.table,{children:["\n",(0,d.jsxs)(n.thead,{children:["\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.th,{children:"接口名称"}),"\n",(0,d.jsx)(n.th,{children:"请求方法"}),"\n",(0,d.jsx)(n.th,{children:"接口路径"}),"\n",(0,d.jsx)(n.th,{children:"请求参数"}),"\n",(0,d.jsx)(n.th,{children:"返回参数"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.tbody,{children:["\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.td,{children:"获取 App 配置列表"}),"\n",(0,d.jsx)(n.td,{children:"GET"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/apps"})}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"IDifyAppItem[]"})}),"\n"]}),"\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.td,{children:"获取 App 配置详情"}),"\n",(0,d.jsx)(n.td,{children:"GET"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/apps/:id"})}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"IDifyAppItem"})}),"\n"]}),"\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.td,{children:"添加 App 配置"}),"\n",(0,d.jsx)(n.td,{children:"POST"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/apps"})}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"IDifyAppItem"})}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n"]}),"\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.td,{children:"更新 App 配置"}),"\n",(0,d.jsx)(n.td,{children:"PUT"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/apps/:id"})}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"IDifyAppItem"})}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n"]}),"\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.td,{children:"删除 App 配置"}),"\n",(0,d.jsx)(n.td,{children:"DELETE"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/apps/:id"})}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.h3,{id:"nextjs-版本",children:["Next.js 版本",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#nextjs-版本",children:"#"})]}),"\n",(0,d.jsxs)(n.h4,{id:"配置入口-1",children:["配置入口",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置入口-1",children:"#"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",meta:'title="packages/nextjs-app/services/app/multiApp/index.ts"',children:'# 使用 fs 实现\nexport * from "./fs";\n'})}),"\n",(0,d.jsxs)(n.h4,{id:"内置实现-1",children:["内置实现",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#内置实现-1",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"1. 本地文件存储"})}),"\n",(0,d.jsx)(n.p,{children:"使用本地文件进行存储，支持完整的 CRUD，但存在丢失数据的风险。"}),"\n",(0,d.jsx)(n.p,{children:"配置示例："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",meta:'title="packages/nextjs-app/.dify-chat/storage/apps.json"',children:'[\n  {\n    "id": "1751001348066",\n    "info": {\n      "name": "Chatflow Demo",\n      "description": "",\n      "tags": [\n        "参数",\n        "测试"\n      ],\n      "mode": "advanced-chat",\n      "author_name": "Dify"\n    },\n    "requestConfig": {\n      "apiBase": "https://api.dify.ai/v1",\n      "apiKey": "app-xxx"\n    },\n    "answerForm": {\n      "enabled": true,\n      "feedbackText": "你提交了一个表单"\n    },\n    "inputParams": {\n      "enableUpdateAfterCvstStarts": true\n    },\n    "extConfig": {\n      "conversation": {\n        "openingStatement": {\n          "displayMode": "always"\n        }\n      }\n    }\n  }\n]\n'})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"2. Restful API"})}),"\n",(0,d.jsx)(n.p,{children:"通过 API 接口管理，支持完整的 CRUD，推荐使用\uD83C\uDF1F"}),"\n",(0,d.jsxs)(n.p,{children:["默认请求的后端服务地址为 ",(0,d.jsx)(n.code,{children:"http://localhost:3000"}),"，你可以根据你的需要修改。"]}),"\n",(0,d.jsx)(n.p,{children:"启动后端服务："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",meta:'title="packages/server"',children:"pnpm dev\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"自定义后端服务-1",children:["自定义后端服务",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#自定义后端服务-1",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"如果内置的 Restful 实现无法满足你的需求，你可以自定义你的后端服务，请遵循以下步骤进行操作。"}),"\n",(0,d.jsx)(n.p,{children:"首先，修改后端服务地址为你的自定义地址。"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",meta:'title="packages/nextjs-app/services/app/multiApp/restful.ts"',children:"// 比如你的自定义后端服务地址是 http://localhost:4567\nconst API_BASE_URL = 'http://localhost:4567'\n"})}),"\n",(0,d.jsx)(n.p,{children:"然后，实现以下接口："}),"\n",(0,d.jsxs)(n.table,{children:["\n",(0,d.jsxs)(n.thead,{children:["\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.th,{children:"接口名称"}),"\n",(0,d.jsx)(n.th,{children:"请求方法"}),"\n",(0,d.jsx)(n.th,{children:"接口路径"}),"\n",(0,d.jsx)(n.th,{children:"请求参数"}),"\n",(0,d.jsx)(n.th,{children:"返回参数"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.tbody,{children:["\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.td,{children:"获取 App 配置列表"}),"\n",(0,d.jsx)(n.td,{children:"GET"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/apps"})}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"IDifyAppItem[]"})}),"\n"]}),"\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.td,{children:"获取 App 配置详情"}),"\n",(0,d.jsx)(n.td,{children:"GET"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/apps/:id"})}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"IDifyAppItem"})}),"\n"]}),"\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.td,{children:"添加 App 配置"}),"\n",(0,d.jsx)(n.td,{children:"POST"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/apps"})}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"IDifyAppItem"})}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n"]}),"\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.td,{children:"更新 App 配置"}),"\n",(0,d.jsx)(n.td,{children:"PUT"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/apps/:id"})}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"IDifyAppItem"})}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n"]}),"\n",(0,d.jsxs)(n.tr,{children:["\n",(0,d.jsx)(n.td,{children:"删除 App 配置"}),"\n",(0,d.jsx)(n.td,{children:"DELETE"}),"\n",(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/apps/:id"})}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n",(0,d.jsx)(n.td,{children:"无"}),"\n"]}),"\n"]}),"\n"]})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(i,{...e})}):i(e)}let h=c;c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["v0.4.x%2Fguide%2Fapp-config%2Fconfig-multiple%2Fcustom-app-service.mdx"]={toc:[{text:"确定运行模式",id:"确定运行模式",depth:2},{text:"自定义应用配置管理",id:"自定义应用配置管理-1",depth:2},{text:"React SPA 版本",id:"react-spa-版本",depth:3},{text:"配置入口",id:"配置入口",depth:4},{text:"内置实现",id:"内置实现",depth:4},{text:"自定义后端服务",id:"自定义后端服务",depth:4},{text:"Next.js 版本",id:"nextjs-版本",depth:3},{text:"配置入口",id:"配置入口-1",depth:4},{text:"内置实现",id:"内置实现-1",depth:4},{text:"自定义后端服务",id:"自定义后端服务-1",depth:4}],title:"自定义应用配置管理",headingTitle:"自定义应用配置管理",frontmatter:{}}}}]);