"use strict";(self.webpackChunkdify_chat_docs=self.webpackChunkdify_chat_docs||[]).push([["6516"],{6526:function(e,n,t){t.r(n),t.d(n,{default:()=>d});var a=t(1549),s=t(6603),c=t(2118);function i(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",pre:"pre",code:"code",h3:"h3"},(0,s.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.h1,{id:"部署---使用-pm2",children:["部署 - 使用 PM2",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#部署---使用-pm2",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"本文将会介绍如何配置 Nginx，将 Dify Chat 部署到生产环境。"}),"\n",(0,a.jsxs)(n.h2,{id:"生产构建",children:["生产构建",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#生产构建",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"首先需要构建生产版本："}),"\n",(0,a.jsxs)(c.mQ,{children:[(0,a.jsx)(c.OK,{label:"React SPA",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"pnpm build\n"})})}),(0,a.jsx)(c.OK,{label:"Next.js",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"pnpm build:next\n"})})})]}),"\n",(0,a.jsxs)(n.h2,{id:"nginx-配置",children:["Nginx 配置",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#nginx-配置",children:"#"})]}),"\n",(0,a.jsxs)(c.mQ,{children:[(0,a.jsx)(c.OK,{label:"React SPA",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-nginx",meta:'title="nginx.conf"',children:"# 注意：\n# 将 dify-chat.com 替换为你的域名\n# 将 /path/to/dify-chat/packages/react-app/dist/ 替换为你的构建产物路径\nhttp {\n    server {\n        listen 443 ssl;\n        server_name dify-chat.com;\n\n        ssl_certificate     /etc/nginx/ssl/dify-chat.com_bundle.crt;\n        ssl_certificate_key /etc/nginx/ssl/dify-chat.com.key;\n\n        location /dify-chat/ {\n            alias /path/to/dify-chat/packages/react-app/dist/;\n            try_files $uri $uri/ /dify-chat/index.html;\n        }\n    }\n}\n"})})}),(0,a.jsx)(c.OK,{label:"Next.js",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-nginx",meta:'title="nginx.conf"',children:"# 注意：\n# 将 dify-chat-next.com 替换为你的域名\n# 将 /path/to/dify-chat/packages/nextjs-app/ 替换为你的 Next.js 项目根目录\nhttp {\n	server {\n		listen 443 ssl;\n		server_name dify-chat-next.com;\n		root /path/to/dify-chat/packages/nextjs-app;\n\n		ssl_certificate /etc/nginx/ssl/dify-chat-next.com_bundle.crt;\n		ssl_certificate_key /etc/nginx/ssl/dify-chat-next.com.key;\n\n		# 静态资源缓存\n		location /_next/static/ {\n			alias /path/to/dify-chat/packages/nextjs-app/.next/static/;\n			expires 30d;\n			access_log off;\n		}\n\n		# 反向代理所有其他请求到 Next.js 服务\n		location / {\n			proxy_pass http://127.0.0.1:5300;\n			proxy_http_version 1.1;\n			proxy_set_header Upgrade $http_upgrade;\n			proxy_set_header Connection 'upgrade';\n			proxy_set_header Host $host;\n			proxy_cache_bypass $http_upgrade;\n		}\n	}\n}\n"})})})]}),"\n",(0,a.jsxs)(n.h3,{id:"启动-nextjs-项目",children:["启动 Next.js 项目",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#启动-nextjs-项目",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"如果你使用的是 Next.js 版本，推荐使用 PM2 启动项目。"}),"\n",(0,a.jsx)(n.p,{children:"在 PM2 中配置："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",meta:'title="ecosystem.config.js"',children:"module.exports = {\n  apps: [\n    {\n      name: 'dify-chat-nextjs-app',\n      cwd: '/path/to/dify-chat/packages/nextjs-app', // 工作目录\n      script: 'pnpm',\n      args: 'start', // 例如 nextjs 启动命令\n      env: {\n        NODE_ENV: 'production',\n        PORT: 5300,\n      },\n    },\n  ],\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"使用 PM2 启动项目："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"pm2 start /path/to/ecosystem.config.js\n"})}),"\n",(0,a.jsxs)(n.h2,{id:"docker-部署",children:["Docker 部署",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#docker-部署",children:"#"})]})]})}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(i,{...e})}):i(e)}let d=r;r.__RSPRESS_PAGE_META={},r.__RSPRESS_PAGE_META["v0.5.x%2Fguide%2Fdevelopment%2Fdeploy-pm2.mdx"]={toc:[{text:"生产构建",id:"生产构建",depth:2},{text:"Nginx 配置",id:"nginx-配置",depth:2},{text:"启动 Next.js 项目",id:"启动-nextjs-项目",depth:3},{text:"Docker 部署",id:"docker-部署",depth:2}],title:"部署 - 使用 PM2",headingTitle:"部署 - 使用 PM2",frontmatter:{}}}}]);